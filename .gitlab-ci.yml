include: "https://gitlab.gnome.org/GNOME/citemplates/raw/master/flatpak/flatpak_ci_initiative.yml"

flatpak:
  image: "registry.gitlab.gnome.org/gnome/gnome-runtime-images/gnome:master"
  variables:
    MANIFEST_PATH: "app.drey.Blurble.Devel.json"
    FLATPAK_MODULE: "blurble"
    APP_ID: "app.drey.Blurble.Devel"
    RUNTIME_REPO: "https://nightly.gnome.org/gnome-nightly.flatpakrepo"
    BUNDLE: "app.drey.Blurble.Devel.flatpak"
  before_script:
    - "sed -i 's/\"type\" : \"dir\"/\"type\" : \"git\"/g' app.drey.Blurble.Devel.json"
    - "sed -i 's/\"url\" : \".\"/\"url\" : \"https:\\/\\/gitlab.gnome.org\\/pervoj\\/Blurble.git\",\\n\"branch\" : \"main\"/g' app.drey.Blurble.Devel.json"
  extends: ".flatpak"

nightly:
  extends: ".publish_nightly"
  needs:
    - "flatpak"
